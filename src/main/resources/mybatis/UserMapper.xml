<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.visa.dao.UserDao" >
  <select id="selectByManagerIdCount" resultType="java.lang.Integer" parameterType="java.lang.String">
    select count(*) from user 
    where managerId = #{managerId,jdbcType=VARCHAR} 
    <if test="user.userName != null">and userName like CONCAT('%',#{user.userName,jdbcType=VARCHAR},'%')</if>
    <if test="user.roleId != null and user.roleId != 0">and roleId = #{user.roleId,jdbcType=INTEGER}</if>
    and enable = 1
  </select>
  
  <select id="selectByManagerId" resultType="UserVo">
    select u1.*,u2.userName as managerName  
    FROM user u1 
    LEFT JOIN user u2 ON u1.managerId=u2.userId 
    where u1.managerId = #{managerId,jdbcType=VARCHAR} 
    <if test="user.userName != null">and u1.userName like CONCAT('%',#{user.userName,jdbcType=VARCHAR},'%')</if>
    <if test="user.roleId != null and user.roleId != 0">and u1.roleId = #{user.roleId,jdbcType=INTEGER}</if>
    and enable = 1
    limit #{start,jdbcType=INTEGER},#{pageCount,jdbcType=INTEGER}
  </select>
  
  <select id="selectAllCount" resultType="java.lang.Integer">
    select count(*) from user 
    where 1=1 
    <if test="userName != null">and userName like CONCAT('%',#{userName,jdbcType=VARCHAR},'%')</if>
    <if test="roleId != null and roleId != 0">and roleId = #{roleId,jdbcType=INTEGER}</if>
    order by postDt desc 
  </select>
  
  <select id="selectAll" resultType="UserVo">
    select u1.*,u2.userName as managerName  
    FROM user u1 
    LEFT JOIN user u2 ON u1.managerId=u2.userId  
    where 1=1
    <if test="user.userName != null">and u1.userName like CONCAT('%',#{user.userName,jdbcType=VARCHAR},'%')</if>
    <if test="user.roleId != null and user.roleId != 0">and u1.roleId = #{user.roleId,jdbcType=INTEGER}</if>
    order by  enable desc,postDt desc 
    limit #{start,jdbcType=INTEGER},#{pageCount,jdbcType=INTEGER}
  </select>
  
  <select id="selectVisaAllCount" resultType="java.lang.Integer">
    select count(*) from user 
    where roleId in (1,2,3,4,5) 
    <if test="userName != null">and userName like CONCAT('%',#{userName,jdbcType=VARCHAR},'%')</if>
    <if test="roleId != null and roleId != 0">and roleId = #{roleId,jdbcType=INTEGER}</if>
    order by postDt desc 
  </select>
  
  <select id="selectVisaAll" resultType="UserVo">
    select u1.*,u2.userName as managerName  
    FROM user u1 
    LEFT JOIN user u2 ON u1.managerId=u2.userId  
    where u2.roleId in (1,2,3,4,5) 
    <if test="user.userName != null">and u1.userName like CONCAT('%',#{user.userName,jdbcType=VARCHAR},'%')</if>
    <if test="user.roleId != null and user.roleId != 0">and u1.roleId = #{user.roleId,jdbcType=INTEGER}</if>
    order by  enable desc,postDt desc 
    limit #{start,jdbcType=INTEGER},#{pageCount,jdbcType=INTEGER}
  </select>
  
  <select id="selectLineAllCount" resultType="java.lang.Integer">
    select count(*) from user 
    where roleId in (6,7,8,9,10) 
    <if test="userName != null">and userName like CONCAT('%',#{userName,jdbcType=VARCHAR},'%')</if>
    <if test="roleId != null and roleId != 0">and roleId = #{roleId,jdbcType=INTEGER}</if>
    order by postDt desc 
  </select>
  
  <select id="selectLineAll" resultType="UserVo">
    select u1.*,u2.userName as managerName  
    FROM user u1 
    LEFT JOIN user u2 ON u1.managerId=u2.userId  
    where u2.roleId in (6,7,8,9,10) 
    <if test="user.userName != null">and u1.userName like CONCAT('%',#{user.userName,jdbcType=VARCHAR},'%')</if>
    <if test="user.roleId != null and user.roleId != 0">and u1.roleId = #{user.roleId,jdbcType=INTEGER}</if>
    order by  enable desc,postDt desc 
    limit #{start,jdbcType=INTEGER},#{pageCount,jdbcType=INTEGER}
  </select>
  
  <select id="selectByRoleId" resultType="User">
    select *  
    FROM user 
    where roleId = #{roleId,jdbcType=INTEGER} 
    order by userName
    and enable = 1
  </select>
  
  <select id="selectByPrimaryKey" resultType="User" parameterType="java.lang.String" >
    select * from user 
    where userId = #{userId,jdbcType=VARCHAR}
    and enable = 1
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    update user set enable = 0
    where userId = #{userId,jdbcType=VARCHAR}
  </delete>
  
  <delete id="activeByPrimaryKey" parameterType="java.lang.String" >
    update user set enable = 1
    where userId = #{userId,jdbcType=VARCHAR}
  </delete>
  
  <insert id="insert" parameterType="User" >
    insert into user (userId, userName, roleId, 
      pwd, managerId, postDt, deptId)
    values (#{userId,jdbcType=VARCHAR}, #{userName,jdbcType=VARCHAR}, #{roleId,jdbcType=INTEGER}, 
      '123456', #{managerId,jdbcType=INTEGER}, now(),#{deptId,jdbcType=VARCHAR})
  </insert>
  
  <update id="updateByPrimaryKey" parameterType="User" >
    update user
    set userName = #{userName,jdbcType=VARCHAR},
      roleId = #{roleId,jdbcType=INTEGER},
      managerId = #{managerId,jdbcType=INTEGER},
      <if test="pwd != null">pwd = #{pwd,jdbcType=VARCHAR},</if>
      deptId = #{deptId,jdbcType=VARCHAR}
    where userId = #{userId,jdbcType=VARCHAR}
  </update>
  
  <update id="updatePwdByUserId">
    update user
    set pwd = #{pwd,jdbcType=VARCHAR}
    where userId = #{userId,jdbcType=VARCHAR}
  </update>
</mapper>