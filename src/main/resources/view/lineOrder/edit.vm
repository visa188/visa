#header(10,101,"修改线路订单信息")
<script>
    function getProductId(){
        var selectProductId=jQuery("#selectProductId").val();
        jQuery("#lineProductId").val(selectProductId);
        
        if(selectProductId==''){
            return;
        }
        jQuery.ajax({
           type: "POST",
           url: "/lineproduct/getProductInfo.do",
           data:{productId:selectProductId},
           success: function(result){
                if(result!='error'){
                    var depositLimitDate = new Date(result.depositLimitDate);
                    var printTicketLimitDate = new Date(result.printTicketLimitDate);
                    var startDate = new Date(result.startDate);
                    var endDate = new Date(result.endDate);
                    jQuery("#depositLimitDate").val(depositLimitDate.getFullYear()+'-'+(depositLimitDate.getMonth()+1)+'-'+depositLimitDate.getDate());
                    jQuery("#printTicketLimitDate").val(printTicketLimitDate.getFullYear()+'-'+(printTicketLimitDate.getMonth()+1)+'-'+printTicketLimitDate.getDate());
                    jQuery("#travelInfo").val(result.travelInfo);
                    jQuery("#lineCountryId").val(result.lineCountryId);
                    jQuery("#price").val(result.price);
                    jQuery("#startDate").val(startDate.getFullYear()+'-'+(startDate.getMonth()+1)+'-'+startDate.getDate());
                    jQuery("#endDate").val(endDate.getFullYear()+'-'+(endDate.getMonth()+1)+'-'+endDate.getDate());
                    jQuery("#seatNum").val(result.seatNum);
                    jQuery("#leftSeatNum").val(result.leftSeatNum);
					if(result.travelInfoFileUrl!=''){
						jQuery("#travelInfoFileUrl").val(result.travelInfoFileUrl);
						var fileName = result.travelInfoFileUrl.substring(result.travelInfoFileUrl.lastIndexOf('/')+1);
						jQuery('#result').html("<a href='/file/download.do?myfile="+result.travelInfoFileUrl+"'>"+fileName+"</a>");
					}
					jQuery("#travelInfo").val(result.travelInfo);
                }
           }
         });
    }

    function changeProductType(){
        var type=jQuery("#type").val();
        //1 单团;2 散拼
        if(type==1){
            jQuery("#sanpinSelectDiv").hide();
            
            jQuery("#selectProductId").removeClass('js_non_empty');
            #if($userRoleId == $fn.getLineSalesmanRoleId() || $fn.isLineAdminRole($userRoleId))
            jQuery("#price").removeAttr("readonly");
            jQuery("#startDate").removeAttr("readonly");
            jQuery("#endDate").removeAttr("readonly");
            #end
            jQuery("#startDate").datepicker( "option", "disabled", false );
            jQuery("#endDate").datepicker( "option", "disabled", false );
        }else{
            jQuery("#sanpinSelectDiv").show();
            
			jQuery("#lineProductId").val(jQuery("#selectProductId").val());
            jQuery("#selectProductId").addClass('js_non_empty');
            jQuery("#price").attr("readonly","readonly");
            jQuery("#startDate").attr("readonly","readonly");
            jQuery("#endDate").attr("readonly","readonly");
            jQuery("#startDate").datepicker( "option", "disabled", true );
            jQuery("#endDate").datepicker( "option", "disabled", true );
        }
    }
    function setNamelistSize(){
        var nameListSize = parseInt(jQuery("#nameListSize").val());
        var leftSeatNum = parseInt(jQuery("#leftSeatNum").val());
        if(nameListSize>leftSeatNum){
            jQuery("#nameListSize").val("");
            alert('客人数量大于剩余机位数，请重新填写！');
			return;
        }
		calculatePriceSum();
    }
    function ajaxFileUpload()
    {
        jQuery("#loading")
        .ajaxStart(function(){
            jQuery(this).show();
        })//开始上传文件时显示一个图片
        .ajaxComplete(function(){
            jQuery(this).hide();
        });//文件上传完成将图片隐藏起来
        
        jQuery.ajaxFileUpload
        (
            {
                url:'/file/upload.do',//用于文件上传的服务器端请求地址
                secureuri:false,//一般设置为false
                fileElementId:'myfile',//文件上传空间的id属性  <input type="file" id="myfile" name="myfile" />
                dataType: 'text',//返回值类型 一般设置为json
                success: function (data, status)  //服务器成功响应处理函数
                {
                    data = data.replace(/<pre.*?>/g, '');
                    data = data.replace(/<PRE.*?>/g, '');
                    data = data.replace("<PRE>", '');  //ajaxFileUpload会对服务器响应回来的text内容加上<pre>text</pre>前后缀
                    data = data.replace("</PRE>", '');
                    data = data.replace("<pre>", '');
                    data = data.replace("</pre>", ''); //本例中设定上传文件完毕后,服务端会返回给前台[0`filepath]
                    if(data.substring(0, 1) == 0){     //0表示上传成功(后跟上传后的文件路径),1表示失败(后跟失败描述)
                        var result = data.split("#");
                        jQuery('#result').html("文件上传成功<br/><a href='/file/download.do?myfile="+result[1]+"'>"+result[2]+"</a>");
                        jQuery('#travelInfoFileUrl').val(result[1]);
                    }else{
                        jQuery('#result').html('文件上传失败，请重试！！');
                    }
                },
                error: function (data, status, e)//服务器响应失败处理函数
                {
                    jQuery('#result').html('文件上传失败，请重试！！');
                }
            }
        );
        return false;
    }
</script>
    <div class="miancon">
        <div class="maincon_title">
            <span class="ico_order_add">+</span><h2>修改订单信息</h2>
            <div class="right"><a class="ico_order_w" title="订单信息管理" href="/lineOrder/list.do?page=1">+</a></div>
        </div>
        <div class="maincon_fluid">
            <form action="/lineOrder/update.do" method="post" class="form_horizontal hq_form line">
              <input type="hidden" name="orderId" value="$!{lineOrder.orderId}" />  
              <input type="hidden" name="orderSeq" value="$!{lineOrder.orderSeq}" /> 
              <input type="hidden" name="salesmanId" value="$!{lineOrder.salesmanId}" />  
              <input type="hidden" name="currentPage" value="$!{currentPage}" />   
              <input value="$!{lineOrder.lineProductId}" type="hidden" id="lineProductId" name="lineProductId">
                
              <div class="widget_box">
                <div class="widget_title">
                    <span class="ico_order_r"></span>
                    <h3>订单基本信息</h3>
                </div>
                <div class="widget_content">
                    <div class="control_group">
                        <label class="control_label"><span class="ico_must">*</span>订单类型:</label>
                        <div class="controls">
                            <span class="form_item"><select $fn.isReadOnly($userRoleId,1) name="type" id="type" class="text2 js_non_empty" placeholder="订单类型" onchange="changeProductType()">
                                <option value="1" $fn.selected(${lineOrder.type}, "1")>单团</option>
                                <option value="2" $fn.selected(${lineOrder.type}, "2")>散拼团</option>
                            </select></span>
                        </div>                          
                    </div>
                    
                    <div id="sanpinSelectDiv"> 
                        <div class="control_group">
                            <label class="control_label"><span class="ico_must">*</span>散拼团:</label>
                            <div class="controls">
                                <span class="form_item"><select $fn.isReadOnly($userRoleId,1) id="selectProductId" class="text2" placeholder="散拼团" onchange="getProductId()">
                                    <option value="">请选择</option>
                                    #foreach($one in $lineProductList)
                                        <option value="$one.lineProductId" $fn.selected(${lineOrder.lineProductId}, $one.lineProductId)>$one.lineProductName</option>
                                    #end
                                </select></span>
                            </div>
                        </div>
                        <div class="control_group">
                            <label class="control_label"><span class="ico_must">*</span>机票订金时限:</label>
                            <div class="controls">
                                <span class="form_item"><input id="depositLimitDate" type="text" class="text1" placeholder="机票订金时限" readonly></span>
                            </div>   
                        </div>
                        
                        <div class="control_group">
                            <label class="control_label"><span class="ico_must">*</span>出票时限:</label>
                            <div class="controls">
                                <span class="form_item"><input id="printTicketLimitDate" type="text" class="text1" placeholder="出票时限" readonly></span>
                            </div>  
                        </div>
                        
                        <div class="control_group">
                            <label class="control_label"><span class="ico_must">*</span>座位数:</label>
                            <div class="controls">
                                <span class="form_item"><input id="seatNum" type="text" class="text1" placeholder="座位数" readonly></span>
                            </div>  
                        </div>
                        
                        <div class="control_group">
                            <label class="control_label"><span class="ico_must">*</span>余位数:</label>
                            <div class="controls">
                                <span class="form_item"><input id="leftSeatNum" type="text" class="text1" placeholder="余位数" readonly></span>
                            </div>  
                        </div>
                    </div>
                    
                    <div class="control_group">
                      <label class="control_label"><span class="ico_must">*</span>组团社:</label>
                      <div class="controls">
                       <span class="form_item"><input $fn.isReadOnly($userRoleId) value="$!{lineOrder.travelAgency}" name="travelAgency" id="travelAgency" type="text" class="text1" maxlength="50" size="50" placeholder="组团社"></span>
                      </div>
                    </div>  
                    
                    <div class="control_group">
                      <label class="control_label"><span class="ico_must">*</span>联系人:</label>
                      <div class="controls">
                       <span class="form_item"><input $fn.isReadOnly($userRoleId) value="$!{lineOrder.contact}" name="contact" id="contact" type="text" class="text1" maxlength="10" size="10" placeholder="联系人"></span>
                      </div>
                    </div>  
                    
                    <div class="control_group">
                      <label class="control_label"><span class="ico_must">*</span>联系方式:</label>
                      <div class="controls">
                       <span class="form_item"><input $fn.isReadOnly($userRoleId) value="$!{lineOrder.contactNo}" name="contactNo" id="contactNo" type="text" class="text1" maxlength="50" size="50" placeholder="联系方式"></span>
                      </div>
                    </div>  
                    
                    <div class="control_group">
                      <label class="control_label"><span class="ico_must">*</span>出发日期:</label>
                      <div class="controls">
                       <span class="form_item"><input $fn.isReadOnly($userRoleId) value="$fn.format($!{lineOrder.startDate},"yyyy-MM-dd")" type="text"  class="text1 $fn.isReadOnly($userRoleId,2) js_non_empty" maxlength="10" size="10" placeholder="出发日期" name="startDate" id="startDate"></span>
                      </div>
                    </div> 
                    
                    <div class="control_group">
                      <label class="control_label"><span class="ico_must">*</span>归国日期:</label>
                      <div class="controls">
                       <span class="form_item"><input $fn.isReadOnly($userRoleId) value="$fn.format($!{lineOrder.endDate},"yyyy-MM-dd")" type="text"  class="text1 $fn.isReadOnly($userRoleId,2) js_non_empty" maxlength="10" size="10" placeholder="归国日期" name="endDate" id="endDate"></span>
                      </div>
                    </div> 
					
					<div class="control_group">
                      <label class="control_label"><span class="ico_must">*</span>行程说明:</label>
                      <div class="controls">
                           <input value="$!{lineOrder.travelInfoFileUrl}" type="hidden" id="travelInfoFileUrl" name="travelInfoFileUrl">
                           <img src="/images/loading.gif" id="loading" style="display: none;"><input id="myfile" name="myfile" type="file">
                           <input $fn.isDisabled($userRoleId) type="button" id="fileSubmit" name="fileSubmit" value="上传" onclick="return ajaxFileUpload();"><div id="result">#if(${lineOrder.travelInfoFileUrl})<a href='/file/download.do?myfile=$!{lineOrder.travelInfoFileUrl}'>$fn.getFileName($!{lineOrder.travelInfoFileUrl})</a>#else无行程说明文件#end</div>
                      </div>
                    </div>
                    
                    <div class="control_group">
                      <label class="control_label"><span class="ico_must">*</span>行程简介:</label>
                      <div class="controls">
                       <textarea $fn.isReadOnly($userRoleId) class="text3" id="travelInfo" name="travelInfo" cols="80" rows="5" placeholder="行程简介" maxlength="100">$!{lineOrder.travelInfo}</textarea>
                      </div>
                    </div>  
                    
                    <div class="control_group">
                        <label class="control_label"><span class="ico_must">*</span>国家名称:</label>
                        <div class="controls">
                            <span class="form_item"><select $fn.isReadOnly($userRoleId,1) name="lineCountryId" id="lineCountryId" class="text2 js_non_empty" placeholder="国家名称" #if($userRoleId==${fn.getLineSalesmanRoleId()}||${fn.isLineAdminRole($userRoleId)}) onchange="getOperators()" #end>
                                <option value="" selected="selected">请选择</option>
                                #foreach($one in $countryList)
                                    <option value="$one.countryId" $fn.selected(${lineOrder.lineCountryId}, $one.countryId)>$one.countryName</option>
                                #end
                            </select></span>
                        </div>                          
                    </div>
                    
                    <div class="control_group">
                      <label class="control_label"><span class="ico_must">*</span>客人数量:</label>
                      <div class="controls">
                       <span class="form_item"><input $fn.isReadOnly($userRoleId) value="$!{lineOrder.nameListSize}" name="nameListSize" id="nameListSize" type="text" class="text1 js_non_empty js_nan" maxlength="8" size="8" placeholder="客人数量" onchange="setNamelistSize()"></span>
                      </div>
                    </div>
                    
                    <div class="control_group">
                        <label class="control_label"><span class="ico_must">*</span>客人信息:</label>
                        <div class="controls" id="customTab">
                            <div class="client_operate js_line_client_operate">
                                <table cellpadding="0" cellspacing="0" class="client_table_data table_data">
                                    <thead>
                                        <tr>
                                            <th>客人信息</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    #if($customList.size() > 0)
                                        #foreach($custom in $customList)
                                            <tr>
                                                <td>
                                           <input type="hidden" id="tempId" name="tempId" value="$!{custom.id}" />
                                                                                                                                    姓名:<input $fn.isReadOnly($userRoleId) value="$!{custom.name}" type="text" class="tb_text" name="tempName" value="" placeholder="客户姓名" style="width:8%;"/>
                                                                                                                                    性别:<select $fn.isReadOnly($userRoleId,1) name="tempSex" placeholder="客人性别"><option value="1" $fn.selected(${custom.sex}, "1")>男</option><option value="2" $fn.selected(${custom.sex}, "2")>女</option></select>
                                                                                                                                    类型:<select $fn.isReadOnly($userRoleId,1) name="tempAgeType" placeholder="客人类型"><option value="1" $fn.selected(${custom.ageType}, "1")>成人</option><option value="2" $fn.selected(${custom.ageType}, "2")>儿童(占床)</option><option value="3"  $fn.selected(${custom.ageType}, "3")>儿童(不占床)</option></select>                            
                                                                                                                                    押金:<input $fn.isReadOnly($userRoleId) value="$!{custom.deposit}" type="text" class="tb_text" name="tempDeposit" value="" placeholder="押金" style="width:8%;"/>
                                                                                                                                    资料:<input $fn.isReadOnly($userRoleId) value="$!{custom.datum}" type="text" class="tb_text" name="tempDatum" value="" placeholder="资料" style="width:10%;"/>
                                                                                                                                    房间数:<input $fn.isReadOnly($userRoleId) value="$!{custom.room}" type="text" class="tb_text" name="tempRoom" value="" placeholder="房间数" style="width:8%;"/>
                                                                                                                                    备注:<input $fn.isReadOnly($userRoleId) value="$!{custom.comment}" type="text" class="tb_text" name="tempComment" value="" placeholder="备注" style="width:5%;"/>
                                          <span $fn.isDisplay($userRoleId) name="delName" class="client_delete" title="删除行" style="margin-left:5%">-</span>
                                                </td>
                                            </tr> 
                                        #end
                                    #else
                                        <tr>
                                                <td>
                                          <input type="hidden" id="tempId" name="tempId" value="" />
                                                                                                                                    姓名:<input type="text" class="tb_text" name="tempName" value="" placeholder="客户姓名" style="width:8%;"/>
                                                                                                                                    性别:<select name="tempSex" placeholder="客人性别"><option value="1">男</option><option value="2">女</option></select>
                                                                                                                                    类型:<select name="tempAgeType" placeholder="客人类型"><option value="1">成人</option><option value="2">儿童(占床)</option><option value="3">儿童(不占床)</option></select>                            
                                                                                                                                    押金:<input type="text" class="tb_text" name="tempDeposit" value="" placeholder="押金" style="width:8%;"/>
                                                                                                                                    资料:<input type="text" class="tb_text" name="tempDatum" value="" placeholder="资料" style="width:10%;"/>
                                                                                                                                    房间数:<input type="text" class="tb_text" name="tempRoom" value="" placeholder="房间数" style="width:8%;"/>
                                                                                                                                    备注:<input type="text" class="tb_text" name="tempComment" value="" placeholder="备注" style="width:5%;"/>
                                          <span name="delName" class="client_delete" title="删除行" style="margin-left:5%">-</span>
                                                </td>
                                            </tr>
                                    #end          
                                    </tbody>
                                </table><span class="form_item"><input type="hidden" class="js_non_empty" id="nameList" name="nameList" value="" placeholder="客人信息"></span>
                                <div $fn.isDisplay($userRoleId) class="client_operate_btns">
                                    <span class="client_add" title="添加行">+</span>
                                </div>
                            </div>
                        </div>                          
                    </div>
                    
                    <div class="control_group">
                      <label class="control_label"><span class="ico_must">*</span>服务:</label>
                      <div class="controls">
                            <div class="client_operate">
                                <table cellpadding="0" cellspacing="0" class="client_table_data table_data">
                                    <thead>
                                        <tr>
                                            <th>服务信息</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                       <input type="hidden" id="ld" name="ld" />
                       <input type="hidden" id="ldservId" name="ldservId" value="$!{lineServiceMap.get(1).serviceId}" />
                       #if($lineServiceMap.get(1))
                       <span class="form_item"><input $fn.isDisabled($userRoleId) type="checkbox" checked id="ldserv" style="vertical-align: middle;"/> 领队服务 <select $fn.isReadOnly($userRoleId,1) id="ldtype"><option value="1" $fn.selected(${lineServiceMap.get(1).serviceItem1}, "1")>组团社派</option><option value="2" $fn.selected(${lineServiceMap.get(1).serviceItem1}, "2")>启航假期派</option></select>#if($userRoleId == $fn.getLineOperatorManagerRoleId() || $fn.isLineAdminRole($userRoleId)) 操作员:<select name="ldpai" id="ldpai"></select>#end 领队名字:<input #if(!($userRoleId == $fn.getLineOperatorRoleId() || $fn.isLineAdminRole($userRoleId)))readonly#end value="$!{lineServiceMap.get(1).serviceItem2}" type="text" class="tb_text" id="ldmz" style="width:12%;"/></span>
                       #else
                       <span class="form_item"><input $fn.isDisabled($userRoleId) type="checkbox" id="ldserv" style="vertical-align: middle;"/> 领队服务 <select $fn.isReadOnly($userRoleId,1) id="ldtype"><option value="1">组团社派</option><option value="2">启航假期派</option></select>#if($userRoleId == $fn.getLineOperatorManagerRoleId() || $fn.isLineAdminRole($userRoleId)) 操作员:<select name="ldpai" id="ldpai"></select>#end 领队名字:<input #if(!($userRoleId == $fn.getLineOperatorRoleId() || $fn.isLineAdminRole($userRoleId)))readonly#end type="text" class="tb_text" id="ldmz" style="width:12%;"/></span>
                       #end
                       </td></tr><tr><td>
                       <input type="hidden" id="qz" name="qz" />
                       <input type="hidden" id="qzservId" name="qzservId" value="$!{lineServiceMap.get(2).serviceId}" />
                       #if($lineServiceMap.get(2))
                       <span class="form_item"><input $fn.isDisabled($userRoleId) type="checkbox" checked id="qzserv" style="vertical-align: middle;"/> 签证服务 <select $fn.isReadOnly($userRoleId,1) id="qztype"><option value="1" $fn.selected(${lineServiceMap.get(2).serviceItem1}, "1")>个签</option><option value="2" $fn.selected(${lineServiceMap.get(2).serviceItem1}, "2")>团签</option></select> 应收单价:<input $fn.isReadOnly($userRoleId) value="$!fn.disPrice(${lineServiceMap.get(2).servicePrice})" type="text" class="tb_text ysdj" id="qzysdj" style="width:12%;"/> 应收合计:<input $fn.isReadOnly($userRoleId) value="$!fn.disPrice(${lineServiceMap.get(2).priceSum})" type="text" class="tb_text" id="qzyshj" style="width:12%;"/>#if($userRoleId == $fn.getLineVisaoperManagerRoleId() || $fn.isLineAdminRole($userRoleId)) 签证员:<select name="qzpai" id="qzpai"></select>#end</span>
                       #else
                       <span class="form_item"><input $fn.isDisabled($userRoleId) type="checkbox" id="qzserv" style="vertical-align: middle;"/> 签证服务 <select $fn.isReadOnly($userRoleId,1) id="qztype"><option value="1">个签</option><option value="2">团签</option></select> 应收单价:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text ysdj" id="qzysdj" style="width:12%;"/> 应收合计:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text" id="qzyshj" style="width:12%;"/>#if($userRoleId == $fn.getLineVisaoperManagerRoleId() || $fn.isLineAdminRole($userRoleId)) 签证员:<select name="qzpai" id="qzpai"></select>#end</span>
                       #end
                       </td></tr><tr><td>
                       <input type="hidden" id="jp" name="jp" />
                       <input type="hidden" id="jpservId" name="jpservId" value="$!{lineServiceMap.get(3).serviceId}" />
                       #if($lineServiceMap.get(3))
                       <span class="form_item"><input $fn.isDisabled($userRoleId) type="checkbox" checked id="jpserv" style="vertical-align: middle;"/> 机票服务 <select $fn.isReadOnly($userRoleId,1) id="jptype"><option value="1" $fn.selected(${lineServiceMap.get(3).serviceItem1}, "1")>团队机票</option><option value="2" $fn.selected(${lineServiceMap.get(3).serviceItem1}, "2")>散客机票</option></select> 应收单价:<input $fn.isReadOnly($userRoleId) value="$!fn.disPrice(${lineServiceMap.get(3).servicePrice})" type="text" class="tb_text ysdj" id="jpysdj" style="width:12%;"/> 应收合计:<input $fn.isReadOnly($userRoleId) value="$!fn.disPrice(${lineServiceMap.get(3).priceSum})" type="text" class="tb_text" id="jpyshj" style="width:12%;"/>#if($userRoleId == $fn.getLineOperatorManagerRoleId() || $fn.isLineAdminRole($userRoleId)) 操作员:<select name="jppai" id="jppai"></select>#end 航班信息:<input #if(!($userRoleId == $fn.getLineOperatorRoleId() || $fn.isLineAdminRole($userRoleId)))readonly#end value="$!{lineServiceMap.get(3).serviceItem5}" type="text" class="tb_text" id="jphbxx" style="width:12%;"/> 定金时限:<input #if(!($userRoleId == $fn.getLineOperatorRoleId() || $fn.isLineAdminRole($userRoleId)))readonly#end value="$!{lineServiceMap.get(3).serviceItem6}" type="text" class="tb_text #if($userRoleId == $fn.getLineOperatorRoleId() || $fn.isLineAdminRole($userRoleId))js_datepicker #end" id="jpdjsx" style="width:12%;"/> 出票时限:<input #if(!($userRoleId == $fn.getLineOperatorRoleId() || $fn.isLineAdminRole($userRoleId)))readonly#end value="$!{lineServiceMap.get(3).serviceItem7}" type="text" class="tb_text #if($userRoleId == $fn.getLineOperatorRoleId() || $fn.isLineAdminRole($userRoleId))js_datepicker #end" id="jpcpsx" style="width:12%;"/></span>
                       #else
                       <span class="form_item"><input $fn.isDisabled($userRoleId) type="checkbox" id="jpserv" style="vertical-align: middle;"/> 机票服务 <select $fn.isReadOnly($userRoleId,1) id="jptype"><option value="1">团队机票</option><option value="2">散客机票</option></select> 应收单价:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text ysdj" id="jpysdj" style="width:12%;"/> 应收合计:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text" id="jpyshj" style="width:12%;"/>#if($userRoleId == $fn.getLineOperatorManagerRoleId() || $fn.isLineAdminRole($userRoleId)) 操作员:<select name="jppai" id="jppai"></select>#end 航班信息:<input #if(!($userRoleId == $fn.getLineOperatorRoleId() || $fn.isLineAdminRole($userRoleId)))readonly#end value="" type="text" class="tb_text" id="jphbxx" style="width:12%;"/> 定金时限:<input #if(!($userRoleId == $fn.getLineOperatorRoleId() || $fn.isLineAdminRole($userRoleId)))readonly#end value="" type="text" class="tb_text #if($userRoleId == $fn.getLineOperatorRoleId() || $fn.isLineAdminRole($userRoleId))js_datepicker #end" id="jpdjsx" style="width:12%;"/> 出票时限:<input #if(!($userRoleId == $fn.getLineOperatorRoleId() || $fn.isLineAdminRole($userRoleId)))readonly#end value="" type="text" class="tb_text #if($userRoleId == $fn.getLineOperatorRoleId() || $fn.isLineAdminRole($userRoleId))js_datepicker #end" id="jpcpsx" style="width:12%;"/></span>
                       #end
                       </td></tr><tr><td>
                       <input type="hidden" id="dj" name="dj" />
                       <input type="hidden" id="djservId" name="djservId" value="$!{lineServiceMap.get(4).serviceId}" />
                       #if($lineServiceMap.get(4))
                       <span class="form_item"><input $fn.isDisabled($userRoleId) type="checkbox" checked id="djserv" style="vertical-align: middle;"/> 地接服务  酒店标准:<input $fn.isReadOnly($userRoleId) value="$!{lineServiceMap.get(4).serviceItem1}" type="text" class="tb_text" id="djxing" style="width:4.3%;"/>星,房型:<input $fn.isReadOnly($userRoleId) value="$!{lineServiceMap.get(4).serviceItem2}" type="text" class="tb_text" id="djfx" style="width:12%;"/> 备注:<input $fn.isReadOnly($userRoleId) value="$!{lineServiceMap.get(4).serviceItem3}" type="text" class="tb_text" id="djbz" style="width:12%;" /> 特殊景点:<input $fn.isReadOnly($userRoleId) value="$!{lineServiceMap.get(4).serviceItem4}" type="text" class="tb_text" id="djtsjd" style="width:12%;"/>#if($userRoleId == $fn.getLineOperatorManagerRoleId() || $fn.isLineAdminRole($userRoleId)) 操作员:<select name="djpai" id="djpai"></select>#end</span>
                       <span class="form_item"><input $fn.isDisabled($userRoleId) type="radio" id="djdyra" name="djdy" style="vertical-align: middle;" #if("${lineServiceMap.get(4).serviceType}"=="41")checked#end/> 巴士: <input $fn.isReadOnly($userRoleId) value="$!{lineServiceMap.get(4).serviceItem5}" type="text" class="tb_text" id="djbs" style="width:4.3%;"/> 备注:<input $fn.isReadOnly($userRoleId) value="$!{lineServiceMap.get(4).serviceItem6}" type="text" class="tb_text" id="djbsbz" style="width:12%;" /> 导游:<select $fn.isReadOnly($userRoleId,1) id="djsfxydy"><option value="1" $fn.selected($!{lineServiceMap.get(4).serviceItem7}, "1")>需要</option><option value="2" $fn.selected($!{lineServiceMap.get(4).serviceItem7}, "2")>不需要</option></select> 备注:<input $fn.isReadOnly($userRoleId) value="$!{lineServiceMap.get(4).serviceItem8}" type="text" class="tb_text" id="djsfxydybz" style="width:12%;" /> <input $fn.isDisabled($userRoleId) type="radio" id="djdyrb" name="djdy" style="vertical-align: middle;" #if("${lineServiceMap.get(4).serviceType}"=="42")checked#end/> 司机兼导游: 备注:<input $fn.isReadOnly($userRoleId) value="#if("${lineServiceMap.get(4).serviceType}"=="42")${lineServiceMap.get(4).serviceItem5}#end" type="text" class="tb_text" id="djsjjdybz" style="width:12%;" /></span>
                       <span class="form_item">应收单价:<input $fn.isReadOnly($userRoleId) value="$!fn.disPrice(${lineServiceMap.get(4).servicePrice})" type="text" class="tb_text ysdj" id="djysdj" style="width:12%;"/> 应收合计:<input $fn.isReadOnly($userRoleId) value="$!fn.disPrice(${lineServiceMap.get(4).priceSum})" type="text" class="tb_text" id="djyshj" style="width:12%;"/></span>
                       #else
                       <span class="form_item"><input $fn.isDisabled($userRoleId) type="checkbox" id="djserv" style="vertical-align: middle;"/> 地接服务  酒店标准:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text" id="djxing" style="width:4.3%;"/>星,房型:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text" id="djfx" style="width:12%;"/> 备注:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text" id="djbz" style="width:12%;" /> 特殊景点:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text" id="djtsjd" style="width:12%;"/>#if($userRoleId == $fn.getLineOperatorManagerRoleId() || $fn.isLineAdminRole($userRoleId)) 操作员:<select name="djpai" id="djpai"></select>#end</span>
                       <span class="form_item"><input $fn.isDisabled($userRoleId) type="radio" id="djdyra" name="djdy" style="vertical-align: middle;" checked/> 巴士: <input type="text" class="tb_text" id="djbs" style="width:4.3%;"/> 备注:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text" id="djbsbz" style="width:12%;" /> 导游:<select $fn.isReadOnly($userRoleId,1) id="djsfxydy"><option value="1">需要</option><option value="2">不需要</option></select> 备注:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text" id="djsfxydybz" style="width:12%;" /> <input $fn.isDisabled($userRoleId) type="radio" id="djdyrb" name="djdy" style="vertical-align: middle;"/> 司机兼导游: 备注:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text" id="djsjjdybz" style="width:12%;" /></span>
                       <span class="form_item">应收单价:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text ysdj" id="djysdj" style="width:12%;"/> 应收合计:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text" id="djyshj" style="width:12%;"/></span>
                       #end
                       </td></tr><tr><td>
                       <input type="hidden" id="qt" name="qt" />
                       <input type="hidden" id="qtservId" name="qtservId" value="$!{lineServiceMap.get(5).serviceId}" />
                       #if($lineServiceMap.get(5))
                       <span class="form_item"><input $fn.isDisabled($userRoleId) type="checkbox" checked id="qtserv" style="vertical-align: middle;"/> 其他服务 备注:<input $fn.isReadOnly($userRoleId) value="$!{lineServiceMap.get(5).serviceItem1}" type="text" class="tb_text" id="qtbz" style="width:10%;"/> 应收单价:<input $fn.isReadOnly($userRoleId) value="$!fn.disPrice(${lineServiceMap.get(5).servicePrice})" type="text" class="tb_text ysdj" id="qtysdj" style="width:12%;"/> 应收合计:<input $fn.isReadOnly($userRoleId) value="$!fn.disPrice(${lineServiceMap.get(5).priceSum})" type="text" class="tb_text" id="qtyshj" style="width:12%;"/></span>
                       #else
                       <span class="form_item"><input $fn.isDisabled($userRoleId) type="checkbox" id="qtserv" style="vertical-align: middle;"/> 其他服务 备注:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text" id="qtbz" style="width:10%;"/> 应收单价:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text ysdj" id="qtysdj" style="width:12%;"/> 应收合计:<input $fn.isReadOnly($userRoleId) type="text" class="tb_text" id="qtyshj" style="width:12%;"/></span>
                       #end
                       </td></tr>  
                                    </tbody>
                                </table>
                            </div>
                        </div>                
                    </div>
                    
                    <div class="control_group">
                      <label class="control_label"><span class="ico_must">*</span>特殊说明:</label>
                      <div class="controls">
                       <span class="form_item"><input $fn.isReadOnly($userRoleId) value="$!{lineOrder.specialComment}" name="specialComment" id="specialComment" type="text" class="text1" maxlength="8" size="8" /></span>
                      </div>
                    </div>
                </div>  
                
                #if($userRoleId == $fn.getLineOperatorManagerRoleId() || $userRoleId == $fn.getLineVisaoperManagerRoleId() || $fn.isLineAdminRole($userRoleId))
                    <script>
                        function getOperators(isedit){
                            var lineCountryId = jQuery("#lineCountryId").val();
                            if(lineCountryId==''){
                                return;
                            }
                            jQuery.ajax({
                               type: "POST",
                               url: "/user/getOperators.do",
                               data:{lineCountryId:lineCountryId,#if(!$fn.isLineAdminRole($userRoleId))managerId:$userUserId,#end roleId:$fn.getLineOperatorRoleId()},
                               success: function(result){
                                    if(result!='error'){
                                        var operatorList=result;
                                        var options='<option value="" selected="selected">请选择</option>';
                                        for(var i=0;i<operatorList.length;i++){
                                            options+='<option value='+operatorList[i].userId+'>'+operatorList[i].userName+'</option>';
                                        }
                                        jQuery("#lineOperatorId option").remove();
                                        jQuery("#lineOperatorId").append(options);
                                        
                                        jQuery("#ldpai option").remove();
                                        jQuery("#ldpai").append(options);
                                        
                                        jQuery("#jppai option").remove();
                                        jQuery("#jppai").append(options);
                                        
                                        jQuery("#djpai option").remove();
                                        jQuery("#djpai").append(options);
                                        
                                        if(isedit==1){
                                            jQuery("#lineOperatorId").val("$!{lineOrder.lineOperatorId}");
                                        }
                                    }
                               }
                             });
                             jQuery.ajax({
                               type: "POST",
                               url: "/user/getOperators.do",
                               data:{lineCountryId:lineCountryId,#if(!$fn.isLineAdminRole($userRoleId))managerId:$userUserId,#end roleId:$fn.getLineVisaoperRoleId()},
                               success: function(result){
                                    if(result!='error'){
                                        var operatorList=result;
                                        var options='<option value="" selected="selected">请选择</option>';
                                        for(var i=0;i<operatorList.length;i++){
                                            options+='<option value='+operatorList[i].userId+'>'+operatorList[i].userName+'</option>';
                                        }
                                        jQuery("#visaOperatorId option").remove();
                                        jQuery("#visaOperatorId").append(options);
                                        
                                        jQuery("#qzpai option").remove();
                                        jQuery("#qzpai").append(options);
                                        
                                        if(isedit==1){
                                            jQuery("#visaOperatorId").val("$!{lineOrder.visaOperatorId}");
                                        }
                                    }
                               }
                             });
                        }
                    </script>
                    <div class="widget_title">
                        <span class="ico_static_r"></span>
                        <h3>操作信息</h3>
                    </div>
                    <div class="widget_content">
                        #if($userRoleId == $fn.getLineOperatorManagerRoleId() || $fn.isLineAdminRole($userRoleId))
                        <div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>线路操作员:</label>
                          <div class="controls">
                           <span class="form_item"><select name="lineOperatorId" id="lineOperatorId" class="text2 js_non_empty" placeholder="线路操作员">
                                <option value="" selected="selected">请选择</option>
                                
                            </select></span>
                          </div>
                        </div>
                        #end
                        #if($userRoleId == $fn.getLineVisaoperManagerRoleId() || $fn.isLineAdminRole($userRoleId))
                        <div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>签证操作员:</label>
                          <div class="controls">
                           <span class="form_item"><select name="visaOperatorId" id="visaOperatorId" class="text2 js_non_empty" placeholder="签证操作员">
                                <option value="" selected="selected">请选择</option>
                                
                            </select></span>
                          </div>
                        </div>  
                        #end
                    </div>
                    <script>
                        getOperators(1);
                    </script>
				#end
				#if($userRoleId == $fn.getLineOperatorRoleId() || $fn.isLineAdminRole($userRoleId))
                    <div class="widget_title">
                        <span class="ico_static_r"></span>
                        <h3>应付明细</h3>
                    </div>
                    <div class="widget_content">
                        #set($jpService = $!{lineServiceMap.get(3)}) 
                        #if($jpService)
    						<div class="control_group">
                              <label class="control_label"><span class="ico_must">*</span> 航空公司:</label>
                              <div class="controls">
                               <span class="form_item">
    								<select name="hkgs" id="hkgs" class="text2 js_non_empty">
                                    #foreach($one in $airlineList)
                                        <option value="$one.airlineId" $fn.selected($!{jpService.serviceItem3}, $one.airlineId)>$one.airlineName</option>
                                    #end
    								</select>
    							</span>
                              </div>
                            </div>
                            <div class="control_group">
                              <label class="control_label"><span class="ico_must">*</span>机票订金:</label>
                              <div class="controls">
                               <span class="form_item">
    								<input value="$!{jpService.serviceItem9}" type="text"  class="text1 js_non_empty" name="jpdj" id="jpdj" placeholder="机票订金">元
                                    <select name="jpdjType" id="jpdjType" class="text2">
                                        <option value="1"  $fn.selected($!{jpService.serviceItem4}, '1')>可退</option>
                                        <option value="2"  $fn.selected($!{jpService.serviceItem4}, '2')>冲机票款</option>
                                    </select>
    							</span>
                              </div>
                            </div>
    						<div class="control_group">
                              <label class="control_label"><span class="ico_must">*</span>应付机票款:</label>
                              <div class="controls">
                               <span class="form_item">
									单价(含税)<input value="$!{jpService.servicePayPrice}" type="text"  class="text1 js_non_empty ysdj" name="yfjpkdj" id="yfjpkdj" placeholder="机票单价">元 
									合计<input value="$!{jpService.yfhj}" type="text"  class="text1 js_non_empty" name="yfjpkhj" id="yfjpkhj" placeholder="机票合计">元
    							</span>
                              </div>
                            </div>
                        #end
                        #set($djService = $!{lineServiceMap.get(4)})  
                        #if($djService)
                        <div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>地接费用合计:</label>
                          <div class="controls">
                           <span class="form_item">#if($djService.serviceItem1)酒店费用#end #if($djService.serviceItem4)特殊景点费用#end #if($djService.serviceType == $fn.getBsServicTypeId())巴士费用#else司兼导费用#end
                           <input value="$!{djService.yfhj}" type="text" class="text1 js_non_empty" name="yfdjhj" id="yfdjhj" placeholder="地接费用合计">元</span>
                          </div>
                        </div>
                        #end  
                        <div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>保险费用:</label>
                          <div class="controls">
                           #set($bxService = $!{lineServiceMap.get(7)})
                           <input type="hidden" name="bxServicId" value="$!{bxService.serviceId}" />  
                           <span class="form_item"><input value="$!{bxService.servicePayPrice}" name="yfbxdj" id="yfbxdj" type="text" class="text1 js_non_empty js_nan ysdj" placeholder="保险单价">元  总计 <input value="$!{bxService.yfhj}" name="yfbxhj" id="yfbxhj" type="text" class="text1 js_non_empty js_nan" placeholder="保险合计">元</span>
                          </div>
                        </div>
                    </div>  
                #end
				#set($visaService = $!{lineServiceMap.get(2)})
				#if($visaService&&($userRoleId == $fn.getLineVisaoperRoleId() || $fn.isLineAdminRole($userRoleId)))
    				<div class="widget_title">
                        <span class="ico_static_r"></span>
                        <h3>签证信息</h3>
                    </div>
                    <div class="widget_content">
    					<div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>送签员:</label>
                          <div class="controls">
                           <span class="form_item"><select name="signOperatorId" id="signOperatorId" class="text2 js_non_empty" placeholder="送签员">
                                <option value="" selected="selected">请选择</option>
                                #foreach($one in $signOperList)
                                    <option value="$one.userId" $fn.selected(${lineOrder.signOperatorId}, $one.userId)>$one.userName</option>
                                #end
                            </select></span>
                          </div>
                        </div>  
						<div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>资料已全:</label>
                          <div class="controls">
                           <span class="form_item">
								<select name="datumIsready" id="datumIsready" class="text2 js_non_empty" placeholder="资料已全">
									<option value="否">否</option>
                                    <option value="是" $fn.selected($!{visaService.serviceItem4}, "是")>是</option>
								</select>
						   </span>
                          </div>
                        </div>
						<div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>资料上交期限:</label>
                          <div class="controls">
                           <span class="form_item">
						   <input value="$!{visaService.serviceItem3}" type="text"  class="text1 js_datepicker js_non_empty" maxlength="10" size="10" placeholder="资料上交期限" name="datumLimitDate" id="datumLimitDate"></span>
                          </div>
                        </div>
						#set($garanteeService = $!{lineServiceMap.get(6)})
						<div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>归国保证方式:</label>
                          <div class="controls">
                           <span class="form_item">
								<select name="garanteeType" id="garanteeType" class="text2 js_non_empty" placeholder="归国保证方式" onchange="showGaranteePrice()">
									<option value="1" $fn.selected($!{garanteeService.serviceItem1}, "1")>承诺函</option>
                                    <option value="2" $fn.selected($!{garanteeService.serviceItem1}, "2")>归国保证金</option>
									<option value="3" $fn.selected($!{garanteeService.serviceItem1}, "3")>联保</option>
								</select>
						   </span>
                          </div>
                        </div>
						<div class="control_group" id="garanteePriceDiv">
                          <label class="control_label"><span class="ico_must">*</span>保证金额:</label>
                          <div class="controls">
							<input type="hidden" name="garanteeServiceId" value="$!{garanteeService.serviceId}" />  
                           <span class="form_item"><input value="$!{garanteeService.priceSum}" name="garanteePrice" id="garanteePrice" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="保证金额"></span>
                          </div>
                        </div>
						<div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>送签日期:</label>
                          <div class="controls">
                           <span class="form_item">
						   <input value="$!{visaService.serviceItem2}" type="text"  class="text1 js_datepicker js_non_empty" maxlength="10" size="10" placeholder="送签日期" name="signDate" id="signDate"></span>
                          </div>
                        </div>  
						<div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>应付签证费（单价）:</label>
                          <div class="controls">
                           <span class="form_item"><input value="$!{visaService.servicePayPrice}" name="servicePayPrice" id="servicePayPrice" type="text" class="text1 js_non_empty js_nan" maxlength="8" size="8" placeholder="应付签证费（单价）" onchange="sumVisaPay();"></span>
                          </div>
                        </div>
						<div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>应付签证费（合计）:</label>
                          <div class="controls">
                           <span class="form_item"><input value="$!fn.disPrice($!{visaService.yfhj})" id="sumServicePayPrice" name="sumServicePayPrice" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="应付签证费（合计）" readonly></span>
                          </div>
                        </div>  
    				</div>	
					<script>
						function sumVisaPay(){
							var size=jQuery("#nameListSize").val()==''?0:jQuery("#nameListSize").val();
							var servicePayPrice=jQuery("#servicePayPrice").val()==''?0:jQuery("#servicePayPrice").val();
							
							var sumServicePayPrice = 0.0;
							if(size&&servicePayPrice){
								sumServicePayPrice = Math.round(parseFloat(servicePayPrice*100*size))/100;
							}
							
							jQuery("#sumServicePayPrice").val(sumServicePayPrice);
						}
						function showGaranteePrice(){
							var garanteePriceDiv = jQuery("#garanteePriceDiv");
							var garanteeType=jQuery("#garanteeType").val();
							if(garanteeType==2 || garanteeType==3){
								garanteePriceDiv.show();
								jQuery("#garanteePrice").addClass('js_non_empty');
							}else{
								jQuery("#garanteePrice").val(0);
								garanteePriceDiv.hide();
								jQuery("#garanteePrice").removeClass('js_non_empty');
							}
						}
						showGaranteePrice();
					</script>
				#elseif($visaService&&$userRoleId == $fn.getLineSignoperRoleId())
					#parse("/view/lineOrder/signEdit.vm")
				#end
                <div class="widget_title">
                    <span class="ico_static_r"></span>
                    <h3>费用计算</h3>
                </div>
                <div class="widget_content">
                    <div class="control_group">
                      <label class="control_label"><span class="ico_must">*</span>应收单价:</label>
                      <div class="controls">
                       <span class="form_item"><input $fn.isReadOnly($userRoleId) value="$!fn.disPrice($!{lineOrder.price})" name="price" id="price" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="应收单价" onchange="calculatePriceSum();" readonly>元</span>
                      </div>
                    </div>
					<div class="control_group">
		              <label class="control_label"><span class="ico_must">*</span>其它应收:</label>
		              <div class="controls">
		               <span class="form_item"><input $fn.isReadOnly($userRoleId) name="qtys" id="qtys" type="text" value="$!fn.disPrice($!{lineOrder.qtys})" class="text1 js_non_empty js_nan" maxlength="8" size="8" placeholder="其它应收" onchange="calculatePriceSum();"></span>
		              </div>
		            </div>
					#if($userRoleId == $fn.getLineFinanceRoleId() || $userRoleId == $fn.getLineFinanceManagerRoleId() || $fn.isLineAdminRole($userRoleId))
						<div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>应收合计:</label>
                          <div class="controls">
							<span class="form_item">应收：<input value="$!fn.disPrice($!{lineOrder.priceSum})" name="priceSum" id="priceSum" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="应收" readonly>元</span>
							<span class="form_item">已收：<input value="$!fn.disPrice($!{lineOrder.alreadyGot})" name="alreadyGot" id="alreadyGot" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="已收" onchange="calculateNeedPaid('tf');">元</span>
							<span class="form_item">未收：<input value="$!fn.disPrice($!{lineOrder.needGot})" name="needGot" id="needGot" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="未收" readonly>元</span>
							<span class="form_item">入账银行：<input value="$!{lineOrder.gotBank}" name="gotBank" id="gotBank" type="text" class="text1" maxlength="8" size="8" placeholder="入账银行"></span>
						    <span class="form_item">入账日期：<input value="$!fn.format($!{lineOrder.gotDate},'yyyy-MM-dd')" name="gotDate" id="gotDate" type="text" class="text1 js_datepicker" maxlength="8" size="8" placeholder="入账日期"></span>
                          </div>
                        </div>
						#set($garanteeService = $!{lineServiceMap.get(6)})
						#if($!{garanteeService.serviceItem1}=='2'||$!{garanteeService.serviceItem1}=='3')
						<input type="hidden" name="garanteeType" value="$!{garanteeService.serviceItem1}" />  
						<div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>$!fn.getVisaTypeName($!{garanteeService.serviceItem1}):</label>
                          <div class="controls">
							<span class="form_item">应收：<input value="$!fn.disPrice($!{garanteeService.priceSum})" name="garanteePriceSum" id="garanteePriceSum" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="应收">元</span>
							<span class="form_item">已收：<input value="$!fn.disPrice($!{garanteeService.alreadyGot})" name="garanteeAlreadyGot" id="garanteeAlreadyGot" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="已收" onchange="calculateNeedPaid('garantee');">元</span>
							<span class="form_item">未收：<input value="$!fn.disPrice($!{garanteeService.needGot})" name="garanteeNeedGot" id="garanteeNeedGot" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="未收" readonly>元</span>
							<span class="form_item">入账银行：<input value="$!{garanteeService.gotBank}" name="garanteeGotBank" id="garanteeGotBank" type="text" class="text1" maxlength="8" size="8" placeholder="入账银行"></span>
						    <span class="form_item">入账日期：<input value="$!fn.format($!{garanteeService.gotDate},'yyyy-MM-dd')" name="garanteeGotDate" id="garanteeGotDate" type="text" class="text1 js_datepicker" maxlength="8" size="8" placeholder="入账日期"></span>
							<span class="form_item">已退：<input value="$!fn.disPrice($!{garanteeService.alreadyPaid})" name="garanteeAlreadyPaid" id="garanteeAlreadyPaid" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="已退">元</span>
							<span class="form_item">转出银行：<input value="$!{garanteeService.paidBank}" name="garanteePaidBank" id="garanteePaidBank" type="text" class="text1" maxlength="8" size="8" placeholder="转出银行"></span>
						    <span class="form_item">付款日期：<input value="$!fn.format($!{garanteeService.paidDate},'yyyy-MM-dd')" name="garanteePaidDate" id="garanteePaidDate" type="text" class="text1 js_datepicker" maxlength="8" size="8" placeholder="付款日期"></span>
                          </div>
                        </div>
						#end
						#set($jpService = $!{lineServiceMap.get(3)})
						#if($!jpService)
						<div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>机票费用合计:</label>
                          <div class="controls">
							<span class="form_item">应付：<input value="$!fn.disPrice($!{jpService.yfhj})" type="text" class="text1 js_nan" name="jpPriceSum" id="jpPriceSum" placeholder="应付" onchange="calculateProfit();">元</span>
							<span class="form_item">已付：<input value="$!fn.disPrice($!{jpService.alreadyPaid})" name="jpAlreadyPaid" id="jpAlreadyPaid" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="已付" onchange="calculateNeedPaid('jp');">元</span>
							<span class="form_item">未付：<input value="$!fn.disPrice($!{jpService.needPaid})" name="jpNeedPaid" id="jpNeedPaid" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="未付" readonly>元</span>
							<span class="form_item">转出银行：<input value="$!{jpService.paidBank}" name="jpPaidBank" id="jpPaidBank" type="text" class="text1" maxlength="8" size="8" placeholder="转出银行"></span>
						    <span class="form_item">付款日期：<input value="$!fn.format($!{jpService.paidDate},'yyyy-MM-dd')" name="jpPaidDate" id="jpPaidDate" type="text" class="text1 js_datepicker" maxlength="8" size="8" placeholder="付款日期"></span>
    						  #if($!{jpService.serviceItem4}=='1')
								<span class="form_item">机票订金（可退）：<input value="$!fn.disPrice($!{jpService.serviceItem9})" name="jpPaidJpdj" id="jpPaidJpdj" type="text" class="text1 js_datepicker" maxlength="8" size="8" placeholder="机票订金（可退）"></span>
								<span class="form_item">已退：<input value="$!{jpService.serviceItem5}" name="alreadyPaidJpdj" id="alreadyPaidJpdj" type="text" class="text1" maxlength="8" size="8" placeholder="机票订金（已退）"></span>
								<span class="form_item">退款日期：<input value="$!{jpService.serviceItem6}" name="jpPaidJpdjDate" id="jpPaidJpdjDate" type="text" class="text1 js_datepicker" maxlength="8" size="8" placeholder="退款日期"></span>
    						  #else
								<span class="form_item">机票订金（冲机票款,自动加到已付款中）：<input value="$!fn.disPrice($!{jpService.serviceItem9})" name="jpdjAlreadyPaid" id="jpdjAlreadyPaid" type="text" class="text1 js_datepicker" maxlength="8" size="8" placeholder="机票订金（冲机票款）" onchange="calculateNeedPaid('jp');"></span>
    						  #end
						  </div>
                        </div>	
						#end
						#set($qzService = $!{lineServiceMap.get(2)})
						#if($!qzService)
						<div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>签证费用合计:</label>
                          <div class="controls">
							<span class="form_item">应付：<input value="$!fn.disPrice($!{qzService.yfhj})" type="text" class="text1 js_nan" name="qzPriceSum" id="qzPriceSum" placeholder="应付" onchange="calculateProfit();">元</span>
							<span class="form_item">已付：<input value="$!fn.disPrice($!{qzService.alreadyPaid})" name="qzAlreadyPaid" id="qzAlreadyPaid" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="已付" onchange="calculateNeedPaid('qz');">元</span>
							<span class="form_item">未付：<input value="$!fn.disPrice($!{qzService.needPaid})" name="qzNeedPaid" id="qzNeedPaid" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="未付" readonly>元</span>
							<span class="form_item">转出银行：<input value="$!{qzService.paidBank}" name="qzPaidBank" id="qzPaidBank" type="text" class="text1" maxlength="8" size="8" placeholder="转出银行"></span>
						    <span class="form_item">付款日期：<input value="$!fn.format($!{qzService.paidDate},'yyyy-MM-dd')" name="qzPaidDate" id="qzPaidDate" type="text" class="text1 js_datepicker" maxlength="8" size="8" placeholder="入账日期"></span>
                          </div>
                        </div>	
						#end
						#set($djService = $!{lineServiceMap.get(4)})  
                        #if($djService)
                        <div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>地接费用合计:</label>
                          <div class="controls">
							<span class="form_item">#if($djService.serviceItem1)酒店费用#end #if($djService.serviceItem4)特殊景点费用#end #if($djService.serviceType == $fn.getBsServicTypeId())巴士费用#else司兼导费用#end
							<input value="$!fn.disPrice($!{djService.yfhj})" type="text" class="text1 js_nan" name="djPriceSum" id="djPriceSum" placeholder="应付" onchange="calculateProfit();">元</span>
							<span class="form_item">已付：<input value="$!fn.disPrice($!{djService.alreadyPaid})" name="djAlreadyPaid" id="djAlreadyPaid" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="已付" onchange="calculateNeedPaid('dj');">元</span>
							<span class="form_item">未付：<input value="$!fn.disPrice($!{djService.needPaid})" name="djNeedPaid" id="djNeedPaid" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="未付" readonly>元</span>
							<span class="form_item">转出银行：<input value="$!{djService.paidBank}" name="djPaidBank" id="djPaidBank" type="text" class="text1" maxlength="8" size="8" placeholder="转出银行"></span>
						    <span class="form_item">付款日期：<input value="$!fn.format($!{djService.paidDate},'yyyy-MM-dd')" name="djPaidDate" id="djPaidDate" type="text" class="text1 js_datepicker" maxlength="8" size="8" placeholder="入账日期"></span>
                          </div>
                        </div>
						#end
						#set($qtService = $!{lineServiceMap.get(5)})  
                        #if($qtService)
                        <div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>其它费用合计:</label>
                          <div class="controls">
							<span class="form_item">应付：<input value="$!fn.disPrice($!{qtService.yfhj})" type="text" class="text1 js_nan" name="qtPriceSum" id="qtPriceSum" onchange="calculateProfit();calculateNeedPaid('qt');" placeholder="应付">元</span>
							<span class="form_item">已付：<input value="$!fn.disPrice($!{qtService.alreadyPaid})" name="qtAlreadyPaid" id="qtAlreadyPaid" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="已付" onchange="calculateNeedPaid('qt');">元</span>
							<span class="form_item">未付：<input value="$!fn.disPrice($!{qtService.needPaid})" name="qtNeedPaid" id="qtNeedPaid" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="未付" readonly>元</span>
							<span class="form_item">转出银行：<input value="$!{qtService.paidBank}" name="qtPaidBank" id="qtPaidBank" type="text" class="text1" maxlength="8" size="8" placeholder="转出银行"></span>
						    <span class="form_item">付款日期：<input value="$!fn.format($!{qtService.paidDate},'yyyy-MM-dd')" name="qtPaidDate" id="qtPaidDate" type="text" class="text1 js_datepicker" maxlength="8" size="8" placeholder="入账日期"></span>
                          </div>
                        </div>
                        #end  
						#set($bxService = $!{lineServiceMap.get(7)})
                        #if($bxService)
                        <div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>保险费用:</label>
                          <div class="controls">
							<span class="form_item">应付：<input value="$!fn.disPrice($!{bxService.yfhj})" name="bxPriceSum" id="bxPriceSum" type="text" class="text1 js_nan" placeholder="应付" onchange="calculateProfit();">元</span>
							<span class="form_item">已付：<input value="$!fn.disPrice($!{bxService.alreadyPaid})" name="bxAlreadyPaid" id="bxAlreadyPaid" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="已付" onchange="calculateNeedPaid('bx');">元</span>
							<span class="form_item">未付：<input value="$!fn.disPrice($!{bxService.needPaid})" name="bxNeedPaid" id="bxNeedPaid" type="text" class="text1 js_nan" maxlength="8" size="8" placeholder="未付" readonly>元</span>
							<span class="form_item">转出银行：<input value="$!{bxService.paidBank}" name="bxPaidBank" id="bxPaidBank" type="text" class="text1" maxlength="8" size="8" placeholder="转出银行"></span>
						    <span class="form_item">付款日期：<input value="$!fn.format($!{bxService.paidDate},'yyyy-MM-dd')" name="bxPaidDate" id="bxPaidDate" type="text" class="text1 js_datepicker" maxlength="8" size="8" placeholder="入账日期"></span>
                          </div>
                        </div>
						#end  
						<input type="hidden" id="paidPriceSum" name="paidPriceSum" value="$!fn.disPrice($!{lineOrder.paidPriceSum})" />
						<div class="control_group">
                          <label class="control_label"><span class="ico_must">*</span>毛利:</label>
                          <div class="controls">
							<span class="form_item"><input value="$!fn.disPrice($!{lineOrder.profit})" name="profit" id="profit" type="text" class="text1 js_nan"  placeholder="毛利" readonly>元</span>
                          </div>
                        </div>
						<script>
							function calculateNeedPaid(type){
								if(type == "tf"){
									var priceSumObj = jQuery("#priceSum");
									//团费应收
    								var priceSum=priceSumObj.val()==''?0:priceSumObj.val();
    								//团费已收
    								var alreadyGot=jQuery("#alreadyGot").val()==''?0:jQuery("#alreadyGot").val();
									if(priceSum==0){
										alert("团费应收款不应为0，请重新填写！");
									}else{
										var needGot = Math.round(parseFloat(priceSum*100-alreadyGot*100))/100;
										if(needGot<0){
											alert("团费已收款大于应收款，请重新填写");
										}else{
											jQuery("#needGot").val(isNaN(needGot)?0:needGot);
										}
									}
								}
								
								if(type == "garantee"){
									var garanteePriceSumObj = jQuery("#garanteePriceSum");
									//保证金应收
    								var garanteePriceSum=garanteePriceSumObj.val()==''?0:garanteePriceSumObj.val();
    								//保证金已收
    								var garanteeAlreadyGot=jQuery("#garanteeAlreadyGot").val()==''?0:jQuery("#garanteeAlreadyGot").val();
									if(jpPriceSum==0){
										alert("$!fn.getVisaTypeName($!{garanteeService.serviceItem1})应收款不应为0，请重新填写！");
									}else{
										var needGot = Math.round(parseFloat(garanteePriceSum*100-garanteeAlreadyGot*100))/100;
										if(needGot<0){
											alert("$!fn.getVisaTypeName($!{garanteeService.serviceItem1})已收款大于应收款，请重新填写");
										}else{
											jQuery("#garanteeNeedGot").val(isNaN(needGot)?0:needGot);
										}
									}
								}
							
								if(type == "jp"){
									var jpPriceSumObj = jQuery("#jpPriceSum");
									//机票应付
    								var jpPriceSum=jpPriceSumObj.val()==''?0:jpPriceSumObj.val();
    								//机票已付
    								var jpAlreadyPaid=jQuery("#jpAlreadyPaid").val()==''?0:jQuery("#jpAlreadyPaid").val();
									var jpdjAlreadyPaid = jQuery("#jpdjAlreadyPaid");
									if(typeof jpdjAlreadyPaid != "undefined"){
										jpAlreadyPaid = Math.round(parseFloat(jpAlreadyPaid*100+jpdjAlreadyPaid*100))/100;
									}
									if(jpPriceSum==0){
										alert("机票应付款不应为0，请重新填写！");
									}else{
										var needPaid = Math.round(parseFloat(jpPriceSum*100-jpAlreadyPaid*100))/100;
										if(needPaid<0){
											alert("机票已付款大于应付款，请重新填写");
										}else{
											jQuery("#jpNeedPaid").val(isNaN(needPaid)?0:needPaid);
										}
									}
								}
								
								if(type == "qz"){
									var qzPriceSumObj = jQuery("#qzPriceSum");
									//签证应付
									var qzPriceSum=jQuery("#qzPriceSum").val()==''?0:jQuery("#qzPriceSum").val();
    								//签证已付
									var qzAlreadyPaid=jQuery("#qzAlreadyPaid").val()==''?0:jQuery("#qzAlreadyPaid").val();
									if(qzPriceSum==0){
										alert("签证应付款不应为0，请重新填写！");
									}else{
										var needPaid = Math.round(parseFloat(qzPriceSum*100-qzAlreadyPaid*100))/100;
										if(needPaid<0){
											alert("签证已付款大于应付款，请重新填写");
										}else{
											jQuery("#qzNeedPaid").val(isNaN(needPaid)?0:needPaid);
										}
									}
								}
								
								if(type == "dj"){
									var djPriceSumObj = jQuery("#djPriceSum");
									//地接应付
									var djPriceSum=jQuery("#djPriceSum").val()==''?0:jQuery("#djPriceSum").val();
    								//地接已付
									var djAlreadyPaid=jQuery("#djAlreadyPaid").val()==''?0:jQuery("#djAlreadyPaid").val();
									if(djPriceSum==0){
										alert("地接应付款不应为0，请重新填写！");
									}else{
										var needPaid = Math.round(parseFloat(djPriceSum*100-djAlreadyPaid*100))/100;
										if(needPaid<0){
											alert("地接已付款大于应付款，请重新填写");
										}else{
											jQuery("#djNeedPaid").val(isNaN(needPaid)?0:needPaid);
										}
									}
								}
								
								if(type == "qt"){
									var qtPriceSumObj = jQuery("#qtPriceSum");
									//其它应付
									var qtPriceSum=jQuery("#qtPriceSum").val()==''?0:jQuery("#qtPriceSum").val();
    								//其它已付
									var qtAlreadyPaid=jQuery("#qtAlreadyPaid").val()==''?0:jQuery("#qtAlreadyPaid").val();
									if(qtPriceSum==0){
										alert("其它应付款不应为0，请重新填写！");
									}else{
										var needPaid = Math.round(parseFloat(qtPriceSum*100-qtAlreadyPaid*100))/100;
										if(needPaid<0){
											alert("其它已付款大于应付款，请重新填写");
										}else{
											jQuery("#qtNeedPaid").val(isNaN(needPaid)?0:needPaid);
										}
									}
								}
								
								if(type == "bx"){
									var bxPriceSumObj = jQuery("#bxPriceSum");
									//保险应付
									var bxPriceSum=jQuery("#bxPriceSum").val()==''?0:jQuery("#bxPriceSum").val();
    								//保险已付
									var bxAlreadyPaid=jQuery("#bxAlreadyPaid").val()==''?0:jQuery("#bxAlreadyPaid").val();
									if(bxPriceSum==0){
										alert("保险应付款不应为0，请重新填写！");
									}else{
										var needPaid = Math.round(parseFloat(bxPriceSum*100-bxAlreadyPaid*100))/100;
										if(needPaid<0){
											alert("保险已付款大于应付款，请重新填写");
										}else{
											jQuery("#bxNeedPaid").val(isNaN(needPaid)?0:needPaid);
										}
									}
								}
							}
							
							function calculatePriceSum(){
    							var price=jQuery('#price').val()==''?0:jQuery('#price').val();
    							var qtys=jQuery('#qtys').val()==''?0:jQuery('#qtys').val();
    							var nameListSize = jQuery('#nameListSize').val()==''?0:jQuery('#nameListSize').val();
    							var priceSum = Math.round(parseFloat(price*100*nameListSize+qtys*100))/100;
    							jQuery('#priceSum').val(priceSum);
    						}
							
							function calculateProfit(){
								//总计应收
								var priceSum=(jQuery("#priceSum")&&jQuery("#priceSum").val()=='')?0:jQuery("#priceSum").val();
								//机票应付
								var jpPriceSum=(jQuery("#jpPriceSum")&&jQuery("#jpPriceSum").val()=='')?0:jQuery("#jpPriceSum").val();
								//签证应付
								var qzPriceSum=(jQuery("#qzPriceSum")&&jQuery("#qzPriceSum").val()=='')?0:jQuery("#qzPriceSum").val();
								//地接应付
								var djPriceSum=(jQuery("#djPriceSum")&&jQuery("#djPriceSum").val()=='')?0:jQuery("#djPriceSum").val();
								//其它应付
								var qtPriceSum=(jQuery("#qtPriceSum")&&jQuery("#qtPriceSum").val()=='')?0:jQuery("#qtPriceSum").val();
								//保险应付
								var bxPriceSum=(jQuery("#bxPriceSum")&&jQuery("#bxPriceSum").val()=='')?0:jQuery("#bxPriceSum").val();
								
								//毛利为总应收-总应付
                        		var profit = Math.round(parseFloat(priceSum*100-jpPriceSum*100-qzPriceSum*100-djPriceSum*100-qtPriceSum*100-bxPriceSum*100))/100;
								var paidPriceSum = Math.round(parseFloat(jpPriceSum*100+qzPriceSum*100+djPriceSum*100+qtPriceSum*100+bxPriceSum*100))/100;
								jQuery("#profit").val(isNaN(profit)?0:profit);
								jQuery("#paidPriceSum").val(isNaN(paidPriceSum)?0:paidPriceSum);
							}
							calculateNeedPaid('jp');
							calculateProfit();
						</script>
					#end
                </div>
              </div>
                <div class="form_actions">
                    <button type="reset" class="btn btn_reset">重置</button>
                    <input type="hidden" id="status" name="status" value="0"/>
                    <button type="button" class="btn btn_save" name="bc">保存</button>
                    <button type="button" class="btn btn_save" name="tj">提交</button>
                </div>                
            </form>
        </div>
    </div>
    <script>
    getProductId();
    changeProductType();
    jQuery('.ysdj').blur(function(){
        var nameListSize = jQuery('#nameListSize').val();
        var dj = jQuery(this).val();
        if(!isNaN(nameListSize)&&!isNaN(dj)){
            jQuery(jQuery(this).next()).val(nameListSize * dj);
        }
    });
    jQuery('#nameListSize').change(function(){
        if(!isNaN(jQuery(this).val())){
            jQuery('.ysdj').blur();
        }
    });
   </script>
#footer()
