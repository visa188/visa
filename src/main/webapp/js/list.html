<script type="text/javascript" src="jquery.js"></script>
<form name="form" action="$fn.admin()/series/add.do" method="post">
  <table width="95%" align="center" border="0" cellspacing="0" cellpadding="5" class="tab01">
    <tr>
      <th width="30%" align="right">属性名</th>
      <th width="70%">属性值</th>
    </tr>
    <tr>
      <td align="right">*系列名称</td>
      <td><input type="text" name="name" /></td>
    </tr>
    <input type="hidden" name="extend" />
    <script>
    function getExtend(){
      var extend='{';
      jQuery('[enum]').each(function(i,n){
		var name = jQuery(n).attr('name');
		var value = jQuery(n).val();
		var enumv = jQuery(n).attr('enum');
		var skip = false;
        if(enumv==0 || enumv==1 || enumv==2){
          extend+=name+':'+value;
        }else if(enumv==3){
		  if(extend.indexOf(','+name+':')<0){
			var tmp='[';
			var len = jQuery('[name='+jQuery(n).attr('name')+']:checked').size();
			jQuery('[name='+jQuery(n).attr('name')+']:checked').each(function(i,m){
				tmp+=jQuery(m).val();
				if(i!=len-1){
					tmp+=',';
				}
			});
			tmp+=']';
			extend+=jQuery(n).attr('name')+':'+tmp;
		  }else{
			skip = true;
		  }
        }
        if(!skip){
          extend+=',';
        }
      });
      extend=extend.substring(0,extend.length-1)+'}';
	  alert(extend)
    }
    </script>
    <tr>
      <td align="right">香型</td>
      <td>
	  <select name="xx" enum="2">
          <option value="10001">酱香</option>
		  <option value="10002">浓香</option>
		  <option value="10003">清香</option>
      </select>
	  </td>
    </tr>
	<tr>
	<td align="right">原料</td>
	  <td>
		<input type="text" name="yl" enum="1"/>
		<a href="javascript:;" value="11"/>小麦</a>&nbsp;&nbsp;
		<a href="javascript:;" value="12"/>大豆</a>&nbsp;&nbsp;
		<a href="javascript:;" value="13"/>高粱</a>&nbsp;&nbsp;
	  </td>
	</tr>
	<tr>
	<td align="right">口号</td>
	  <td>
		<input type="text" name="kh" enum="0"/>
	  </td>
	</tr>
	<tr>
	<td align="right">用途</td>
	  <td>
		<input type="checkbox" name="yt" value="101" enum="3"/>礼品&nbsp;&nbsp;
		<input type="checkbox" name="yt" value="102" enum="3"/>自酌&nbsp;&nbsp;
		<input type="checkbox" name="yt" value="103" enum="3"/>请客&nbsp;&nbsp;
	  </td>
	</tr>
    <tr>
      <td colspan="2" align="center">
      <input type="button" value="保存" onclick="getExtend()"/>&nbsp;&nbsp;
      </td>
    </tr>
  </table>
</form>

    <tr>
    <td align="right">原料</td>
    <td>
          <input type="text" name="material" value="123" enum="1" />
      <script type="text/javascript">
      jQuery(document).ready(function(){
        jQuery("a[attr='enum1']").click(function(){
          var textFiled = jQuery(this).prevAll(':input').first();
          var curVal = textFiled.val();
          var aVal = jQuery(this).text();
          if(curVal.charAt(curVal.length-1)!='、'){
            if(curVal.indexOf(aVal)<0){
              aVal = '、'+aVal;
            }else{
              aVal = '';
            }
          }
          textFiled.val(curVal+aVal);
        });
      });
      </script>
              <a href="javascript:;" attr="enum1" value="1032"/>高粱</a>&nbsp;&nbsp;
              <a href="javascript:;" attr="enum1" value="1033"/>大麦</a>&nbsp;&nbsp;
              <a href="javascript:;" attr="enum1" value="1029"/>水</a>&nbsp;&nbsp;
              <a href="javascript:;" attr="enum1" value="1030"/>小麦</a>&nbsp;&nbsp;
              <a href="javascript:;" attr="enum1" value="1031"/>大米</a>&nbsp;&nbsp;
              </td>
  </tr>